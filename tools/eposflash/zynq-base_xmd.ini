set app APP
set gdb GDB
set bit BIT
set pbin PBIN

set empty empty

# Connect to the board through JTAG
connect arm hw

# Configure the FPGA if BIT was set
if {$bit!=$empty} {
    fpga -f $bit
}

# ps7_init.tcl provides functions to initialize the DDR controller and other
# peripherals to a default state, it's generated by Vivado
set path [file dirname [file normalize [info script]]]
source $path/zynq-ps7_init.tcl
ps7_init
ps7_post_config

# Download ELF file to Zynq's memory
dow $app

# Download partial binary bitstream if PBIN was set
if {$pbin!=$empty} {
    dow -data $pbin 0x01000000
}

# Don't continue if GDB is attached
if {$gdb=="0"} {
    con
}
